# Practice 5

## Введение в БД

### Начало работы с БД.
------------------


Заполним нашу БД данными. Мы можем сделать это используя оператор INSERT языка манипулирвоания данными.
> INSERT INTO persons  VALUES   
(1,'Гульнара', 'Нигматзянова','Студентка');

Так как добавлять по одной записи долго и муторно, мы воспользуемся одним скриптом
для всех данных, которые нужно добавить.

> INSERT INTO persons (name, surname,persons_type) VALUES  
  ('Эмиль', 'Атажанов','Студент'),       
  ('Илюза', 'Сакаева','Студент'),  
  ('Захар','Макаров','Студент'),  
  ('Алина', 'Васильева','Студент'),  
  ('Камиль', 'Морковников','Студент'),  
 ('Марина', 'Петрушкина','Студент'),     
 ('Захар','Огурцов','Студент'),    
 ('Лариса', 'Блинчикова','Студент'),  
 ('Екатерина','Федулова','Студент'),   
 ('Анвар','Туйкин', 'Профессор'),   
 ('Наиль','Бухараев', 'Профессор'),   
 ('Элина','Степанова', 'Профессор'),   
 ('Арслан','Еникеев', 'Профессор'),   
 ('Александр','Гусенков', 'Профессор'),   
 ('Виктор','Георгиев', 'Профессор'),   
 ('Михаиль','Щелкунов', 'Профессор'),   
 ('Евгения','Михайловна', 'Профессор'),   
 ('Алия','Барисовна', 'Профессор'),   
 ('Динара','Торфянова','Студент'),  
 ('Кристина','Аркадъевна','Студент'),  
 ('Вася','Пупкин','Студент'),  
 ('Михаиль','Мочалкин','Студент'),  
 ('Иван','Иванов','Студент'),  
 ('Мария','Владимировна', 'Профессор'),  
 ('Критерий','Пирсона', 'Профессор'),  
 ('Сергей','Мокичев', 'Профессор'),  
 ('Фаниль','Серебряков', 'Профессор'),  
 ('Виолетта','Чебакова', 'Профессор'),  
 ('Екатерина','Турилова', 'Профессор'),  
 ('Самигулла','Халиуллин', 'Профессор');  

Перейдем к таблице студентов:
> DELETE FROM students;  
 --удалим якобы имеющиеся данные в таблице студенты

>--добавим данные студенток  
INSERT INTO students (id_person,group_id,sex, town) VALUES  
(1,1,'Ж',DEFAULT),  
(3,4,'Ж','Рязань'),  
(5,3,'Ж','Москва'),  
(7,2,'Ж','Крым'),  
(9,5,'Ж',DEFAULT),   
(10,1,'Ж','Тверь'),  
(20,1,'Ж','Уфа'),  
(21,1,'Ж','Алексеевск');

> --добавим данные студентов
INSERT INTO students (id_person,group_id,sex,  town) VALUES   (2,5,'М','Москва'),   
(4,5,'М',DEFAULT),  
(6,7,'М',DEFAULT),  
(8,1,'М','Агрыз'),  
(22,2,'М','Норильск'),  
(23,2,'М','Стерлитамак'),  
(24,1,'М','Киев');


<i>В каком порядке должны быть указаны данные при использовании команды insert?
-Список столбцов в данной команде не является обязательным параметром.
В этом случае должны быть указаны значения для всех полей таблицы в том порядке,
как эти столбцы были перечислены в команде CREATE TABLE, например:
> INSERT INTO students VALUES (1,'Гульнара', 'Нигматзянова', 'Ж', '2', DEFAULT);

Что будет, если попытаться вставить запись, которая нарушает ограничение уникальности?
-Если пользователь пытается сохранить в какой-либо колонке данные, которые попадают под ограничение, возникнет ошибка.

Что будет, если попытаться удалить из таблицы несуществующие значения?
-Запрос будет успешно выполнен, например:
> DELETE FROM students WHERE town ILIKE 'Махачкала';</i>

>--добавим данные в таблицу группы
INSERT INTO groups (group_number,student_count, faculty, steward) VALUES   
 ( '09-308', 26, 'ИВМиИТ', 6),  
 ( '09-400', 28, 'ИВМиИТ', 10),  
 ( '09-307', 30, 'ИВМиИТ', 9),   
 ('09-306', 10, 'ИТИС', 6),  
 ( '09-411', 7, 'ИВМиИТ',2),   
 ( '09-508', 12, 'ИВМиИТ', 3),   
 ('09-206', 21, 'ИВМиИТ', 1),  
 ('09-211', 25, 'ИТИС', 4),   
 ('09-221', 25, 'ИТИС', 5);

> INSERT INTO groups (group_number,student_count, faculty, steward) VALUES  
 ( '09-308', 26, 'ИВМиИТ', 6),  
 ( '09-400', 28, 'ИВМиИТ', 10),   
 ( '09-307', 30, 'ИВМиИТ', 9),  
 ('09-306', 10, 'ИТИС', 6),   
 ( '09-411', 7, 'ИВМиИТ',2),   
 ( '09-508', 12, 'ИВМиИТ', 3),  
 ('09-206', 21, 'ИВМиИТ', 1),  
 ('09-211', 25, 'ИТИС', 4),   
 ('09-221', 25, 'ИТИС', 5);   
-- мы добавили в нашу таблицу данные, затем случайно повторили. Теперь в нашей таблице дублированные данные.

<i>Почему это произошло?
Как это исправить?
</i>

Мы воспользуемся запросом:
> DELETE FROM groups T1   
 WHERE EXISTS      
    (SELECT *   
    FROM groups T2   
    WHERE  (T2.group_number = T1.group_number or (T2.group_number is null and T2.group_number is null))     
    AND    
    (T2.student_count = T1.student_count or (T2.student_count is null and T2.student_count is null))    
    AND   
     (T2.faculty = T1.faculty or (T2.faculty is null and T2.faculty is null))    
     AND   
     (T2.steward = T1.steward or (T2.steward is null and T2.steward is null))       
     AND   
     (T2.id > T1.id));

Больше дублирующихся данных в таблице нет.
И, чтобы они не повторялись, добавим ограничение на уникальность номера группы.

> ALTER TABLE groups  
 ADD CONSTRAINT group_number_un UNIQUE (group_number);

Попытаемся снова добавить дубликат:
> INSERT INTO groups (group_number,student_count, faculty, steward) VALUES  
 ( '09-308', 26, 'ИВМиИТ', 6),  
 ( '09-400', 28, 'ИВМиИТ', 10),   
 ( '09-307', 30, 'ИВМиИТ', 9),  
 ('09-306', 10, 'ИТИС', 6),   
 ( '09-411', 7, 'ИВМиИТ',2),   
 ( '09-508', 12, 'ИВМиИТ', 3),  
 ('09-206', 21, 'ИВМиИТ', 1),  
 ('09-211', 25, 'ИТИС', 4),   
 ('09-221', 25, 'ИТИС', 5);

У нас это не получится, тк повторяющееся значение ключа нарушает ограничение уникальности "group_number_un".

Но данные в таблице студентов нарушают целостность, поэтому увеличим все коды групп в таблице студентов
> UPDATE  students   
SET group_id = group_id + 20 ;

<i>
Что если в команде UPDATE не указать WHERE?  
-Изменятся все данные, как в нашем примере. </i>

Добавим данные в таблицу профессоров:
> INSERT INTO professors (id_person,faculty,classes,department) VALUES (11,'ИВМиИТ',0,'КТП'),  
(12,'ИВМиИТ',0,'КТП'),  
(13,'ИВМиИТ',0,'КТП'),   
(14,'ИВМиИТ',0,'КТП'),    
(15,'ИВМиИТ',0,'КТП'),  
(16,'ИВМиИТ',0,'КТП'),   
(17,'ИТИС',0,'КТТ'),  
(18,'ИТИС',0,'КТТ'),  
(19,'ИТИС',0,'КТТ'),   
(25,'ИТИС',0,'КТТ'),   
(26,'ИВМиИТ',0,'КМС'),  
(29,'ИВМиИТ',0,'КМС'),  
(30,'ИВМиИТ',0,'КМС'),  
(31,'ИВМиИТ',0,'КМС'),   
(27,'ИСФНиМК',0,'КОФ'),   
(28,'ИУЭиФ',0,'КЭТ');

Добавим данные в таблицу предметы:
> INSERT INTO subjects (name, report_type, subject_type, hours) VALUES   
('Базы Данных', 'Зачет', 'Лекция', 18),  
('Базы Данных', 'Зачет', 'Практика', 18);     

> INSERT INTO subjects (name, report_type, subject_type, hours) VALUES    ('ПАПС', 'Зачет', 'Лекция', 18),   
('ПАПС', 'Зачет', 'Практика', 36),   
('ТПО', 'Зачет', 'Лекция', 18),   
('ТПО', 'Зачет', 'Практика', 36),  
('ОИБ', 'Экзамен', 'Лекция', 36),   
('ОКГ', 'Зачет', 'Практика', 18),   
('ОКГ', 'Зачет', 'Практика', 36),   
('Физ-ра', 'Зачет', 'Практика', 66);   

Добавим данные в таблицу занятия:
> INSERT INTO classes (professors_id, group_id, subject_id, semester, audience, start_time)
 VALUES (5, 23, 1, 5, '1111', '17:00');

> INSERT INTO classes (professors_id, group_id, subject_id, semester, audience, start_time) VALUES   
(1, 19, 2, 5, '910', '15:20'),   
(6, 19, 3, 5, '905', '18:40'),    
(6, 19, 3, 5, '1111', '13:35'),   
(4, 19, 5, 5, '1008', '10:10'),   
(4, 19, 6, 5, '909', '08:30'),    
(3, 19, 8, 4, '905', '10:10'),   
(3, 19, 9, 5, '910', '10:10'),   
(14, 19, 7, 5, '1008', '13:35');
